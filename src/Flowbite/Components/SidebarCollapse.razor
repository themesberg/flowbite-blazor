@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Components.Web
@using Flowbite.Common
@inherits FlowbiteComponentBase

<li style="list-style-type: none;">
    <button @onclick="ToggleStateAsync"
            type="button"
            class="@GetButtonClasses()"
            aria-controls="sidebar-collapse-@Id"
            aria-expanded="@IsExpanded">
        @if (Icon != null)
        {
            <DynamicComponent Type="@Icon.GetType()" Parameters="@(new Dictionary<string, object>
            {
                { "class", "w-5 h-5 text-gray-500 transition duration-75 motion-reduce:transition-none dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-white" },
                { "aria-hidden", true },
            })" />
        }
        <span class="flex-1 ms-3 text-left whitespace-nowrap">@Label</span>
        <ChevronDownIcon class="@GetChevronClasses()" aria-hidden="true" />
    </button>
    <div @ref="_contentRef"
         class="@GetCollapseWrapperClasses()"
         style="@GetContentStyle()"
         @ontransitionend="HandleTransitionEnd">
        <ul id="sidebar-collapse-@Id"
            class="@GetListClasses()"
            style="list-style-type: none;">
            @ChildContent
        </ul>
    </div>
</li>

@code {
    private CollapseState _state = CollapseState.Collapsed;
    private int _height;
    private ElementReference _contentRef;
    private string Id = Guid.NewGuid().ToString("N");

    [Parameter]
    public string? Label { get; set; }

    [Parameter]
    public IconBase? Icon { get; set; }

    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    private string GetButtonClasses() => CombineClasses(
        "flex items-center w-full p-2 text-base text-gray-900 transition duration-75 motion-reduce:transition-none rounded-lg group hover:bg-gray-100 dark:text-white dark:hover:bg-gray-700"
    );

    private string GetChevronClasses() => CombineClasses(
        "w-6 h-6 text-gray-500 transition-transform duration-300 ease-in-out motion-reduce:transition-none dark:text-gray-400 group-hover:text-gray-900 dark:group-hover:text-white",
        IsExpanded ? "rotate-180" : ""
    );

    private string GetCollapseWrapperClasses() => CombineClasses(
        "overflow-hidden transition-[height] duration-300 ease-in-out motion-reduce:transition-none"
    );

    private string GetListClasses() => CombineClasses("py-2 space-y-2 ps-7");
}
